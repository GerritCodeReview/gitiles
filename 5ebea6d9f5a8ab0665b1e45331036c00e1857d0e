{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0ced2ab7_ff721e02",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-03T18:29:58Z",
      "side": 1,
      "message": "Can you add a test for this in `javatests/com/google/gitiles/PathServletTest.java`?",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ebf2714_37ff7a0d",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T13:01:47Z",
      "side": 1,
      "message": "After the changes to `java/com/google/gitiles/PathServlet.java`, servlet tests now fail with `NullPointerException`, pointing to line 557, `head.getLeaf().getName(),`. Any idea on how to take tests into account here?\n\nMy added test is also unfinished. I don\u0027t know how to get the name of the `repo` test repository object. I\u0027m not seeing anything suitable in https://archive.eclipse.org/jgit/site/5.1.2.201810061102-r/apidocs/org/eclipse/jgit/junit/TestRepository.html\n\nI hope it\u0027s otherwise going to a sensible direction.",
      "parentUuid": "0ced2ab7_ff721e02",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2bb9390_47b7d389",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2024-05-14T13:16:09Z",
      "side": 1,
      "message": "AFAICT `head` and `head.getLeaf()` can still be null, so those null-checks are still necessary.\n\n```\n      RefDatabase refdb \u003d ServletUtils.getRepository(req).getRefDatabase();\n      Ref head \u003d refdb.exactRef(Constants.HEAD);\n      Ref headLeaf \u003d head !\u003d null? head.getLeaf() : null;\n      if (headLeaf \u003d\u003d null) {\n        return null;\n      }\n```",
      "parentUuid": "2ebf2714_37ff7a0d",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e35f965_8f16587f",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-14T14:36:24Z",
      "side": 1,
      "message": "\u003e AFAICT `head` and `head.getLeaf()` can still be null, so those null-checks are still necessary.\n\nSorta. It\u0027s only `head` you have to consider. My comment below at https://gerrit-review.googlesource.com/c/gitiles/+/392465/comment/cd2a3b6f_63b2b647/ suggested there should still be a null check for head after you do the `exactRef()` call.",
      "parentUuid": "d2bb9390_47b7d389",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a50d7296_3ae9f130",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T16:24:54Z",
      "side": 1,
      "message": "Thanks, now it fails in a more pleasant way.",
      "parentUuid": "4e35f965_8f16587f",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e03d5adf_09fb8f59",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T16:29:59Z",
      "side": 1,
      "message": "So yeah, I don\u0027t know how to make the test use a config with `gerritUrl` set. The `@Before` block I added is fabulated code for it.",
      "parentUuid": "a50d7296_3ae9f130",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2ffff39_b17c3750",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-14T16:41:34Z",
      "side": 1,
      "message": "\u003e So yeah, I don\u0027t know how to make the test use a config with `gerritUrl` set. The `@Before` block I added is fabulated code for it.\n\nI\u0027m not sure either. Can you do a similar thing as what `RefServletTest` does with `TestGitilesUrls.URLS`?",
      "parentUuid": "e03d5adf_09fb8f59",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "126681f4_89fd86ef",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T17:37:58Z",
      "side": 1,
      "message": "I can\u0027t find anything that I could apply easily. `javatests/com/google/gitiles/TestGitilesAccess.java` has an override for `getConfig()` in `GitilesAccess`, but I don\u0027t know how to apply the same idea in this case.",
      "parentUuid": "c2ffff39_b17c3750",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5d8730b_da7ab154",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2024-05-15T06:53:19Z",
      "side": 1,
      "message": "What requires less rewrite of how the config is handled could be to create a config file and set system property `com.google.gitiles.configPath` to the path of that file?\nhttps://gerrit.googlesource.com/gitiles/+/6a699c7d9822f364d999d8e5e9452b3ab987c3eb/java/com/google/gitiles/GitilesConfig.java#37",
      "parentUuid": "126681f4_89fd86ef",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bff56ae5_edcc465f",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-15T12:11:21Z",
      "side": 1,
      "message": "I have a couple of non-working approaches for your inspiration.\n\nI don\u0027t know what I should do after setting the system property `com.google.gitiles.configPath`.\n\nAs an alternative, I tried FileBasedConfig, but hit a wall there as well.\n\nI checked with `canRead()` that the file can be read from the absolute path, but `buildData()` seems to ignore the loaded config.\n\nGetting `com.google.gitiles.sourcePath` is a problem in itself as it doesn\u0027t seem to be required and I don\u0027t even know how to set it when running tests. Some kind of `--jvm_flag\u003d-Dcom.google.gitiles.sourcePath\u003d...`, but where/how?\n\nAt least I now know that the name of the repo used in the test suite is \"repo\" after printing out the object.",
      "parentUuid": "b5d8730b_da7ab154",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78a6349b_aa6f3b49",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 542,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2024-05-15T12:35:22Z",
      "side": 1,
      "message": "Sorry, that was a wild goose-chase.\nTry setting the config value in this config object before handing it to the GitilesServlet ctor that in turn will pass it along to GitilesFilter that will read it to create the DefaultUrls object with the correct URLs.\nhttps://gerrit.googlesource.com/gitiles/+/0cf4be54b650e8bc47d6eca47a150e0a2ae711a3/javatests/com/google/gitiles/TestGitilesServlet.java#70",
      "parentUuid": "bff56ae5_edcc465f",
      "range": {
        "startLine": 542,
        "startChar": 24,
        "endLine": 542,
        "endChar": 37
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd2a3b6f_63b2b647",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 547,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-03T18:29:58Z",
      "side": 1,
      "message": "`getLeaf()` handles checking `isSymbolic()` for you, so don\u0027t duplicate that.\n\nOnce you also apply the fix for my comment below, you\u0027ll have a specific non-null check for `head` after line 546 and then you can safely update line 557 with `head.getLeaf().getName()`.",
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bc62afe9_81323cf5",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 547,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T13:01:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cd2a3b6f_63b2b647",
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "35eb8ca1_94e4caa3",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 549,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-03T18:29:58Z",
      "side": 1,
      "message": "You should probably do this check earlier (immediately after line 544) so that you can skip the ref lookup when you\u0027re going to return null anyway.",
      "range": {
        "startLine": 549,
        "startChar": 10,
        "endLine": 549,
        "endChar": 31
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3cd09bd4_a0f247eb",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 549,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T13:01:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "35eb8ca1_94e4caa3",
      "range": {
        "startLine": 549,
        "startChar": 10,
        "endLine": 549,
        "endChar": 31
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "067d7193_7a78bd44",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 558,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2024-05-03T18:29:58Z",
      "side": 1,
      "message": "Does this get passed through `escapeName()` or is it escaped some other way?",
      "range": {
        "startLine": 554,
        "startChar": 0,
        "endLine": 558,
        "endChar": 32
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "af1d2d53_aef1c230",
        "filename": "java/com/google/gitiles/PathServlet.java",
        "patchSetId": 6
      },
      "lineNbr": 558,
      "author": {
        "id": 1132393
      },
      "writtenOn": "2024-05-14T13:01:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "067d7193_7a78bd44",
      "range": {
        "startLine": 554,
        "startChar": 0,
        "endLine": 558,
        "endChar": 32
      },
      "revId": "5ebea6d9f5a8ab0665b1e45331036c00e1857d0e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}