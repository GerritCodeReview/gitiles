{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9b3040fc_04d19fcb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 4334051
      },
      "writtenOn": "2025-09-05T00:19:29Z",
      "side": 1,
      "message": "shurymury:CODETOOLS-7904066",
      "revId": "3d52397fffb2ee7f218c4e33f969258011e7c650",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "569e2907_f0fddb47",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 4327447
      },
      "writtenOn": "2025-09-05T18:50:53Z",
      "side": 1,
      "message": "From 3d52397fffb2ee7f218c4e33f969258011e7c650 Mon Sep 17 00:00:00 2001\nFrom: David Pursehouse \u003cdpursehouse@collab.net\u003e\nDate: Sat, 15 Jun 2019 14:06:40 +0900\nSubject: [PATCH] Navbar: Fix handling of [home] and [logo] metalinks\n\nChange I556285369 fixed the \"[extensions]\" meta link from being\nliterally included in the rendered html, but had the side effect\nof breaking the [home] and [logo] metalinks.\n\nRework the fix, and add tests for [home] and [logo] that would\nhave caught the regression.\n\nBug: https://crbug.com/gerrit/11023\nChange-Id: I44ecbe64588077b988aa3671ae94884b6b78d71b\n---\n\ndiff --git a/java/com/google/gitiles/doc/Navbar.java b/java/com/google/gitiles/doc/Navbar.java\nindex c866aa9..0fc2758 100644\n--- a/java/com/google/gitiles/doc/Navbar.java\n+++ b/java/com/google/gitiles/doc/Navbar.java\n@@ -33,6 +33,8 @@\n   private static final Pattern META_LINK \u003d\n       Pattern.compile(\n           \"^\\\\[(logo|home|extensions)\\\\]:\\\\s*(.+)$\", Pattern.MULTILINE | Pattern.CASE_INSENSITIVE);\n+  private static final Pattern EXTENSIONS_LINK \u003d\n+      Pattern.compile(\"^\\\\[extensions\\\\]:\\\\s*(.+)$\", Pattern.MULTILINE | Pattern.CASE_INSENSITIVE);\n \n   private MarkdownConfig cfg;\n   private MarkdownToHtml fmt;\n@@ -108,30 +110,27 @@\n   }\n \n   private String extractMetadata(String markdown) {\n+    boolean extensionsFound \u003d false;\n     Matcher m \u003d META_LINK.matcher(markdown);\n-    boolean foundMetadata \u003d m.find();\n-    if (foundMetadata) {\n-      StringBuffer sb \u003d new StringBuffer();\n-      do {\n-        String key \u003d m.group(1).toLowerCase();\n-        String url \u003d m.group(2).trim();\n-        switch (key) {\n-          case \"logo\":\n-            logoUrl \u003d url;\n-            break;\n-          case \"home\":\n-            homeUrl \u003d url;\n-            break;\n-          case \"extensions\":\n-            Set\u003cString\u003e names \u003d splitExtensionNames(url);\n-            cfg \u003d cfg.copyWithExtensions(enabled(names), disabled(names));\n-            break;\n-        }\n-        m.appendReplacement(sb, \"\");\n-        foundMetadata \u003d m.find();\n-      } while (foundMetadata);\n-      m.appendTail(sb);\n-      return sb.toString();\n+    while (m.find()) {\n+      String key \u003d m.group(1).toLowerCase();\n+      String url \u003d m.group(2).trim();\n+      switch (key) {\n+        case \"logo\":\n+          logoUrl \u003d url;\n+          break;\n+        case \"home\":\n+          homeUrl \u003d url;\n+          break;\n+        case \"extensions\":\n+          extensionsFound \u003d true;\n+          Set\u003cString\u003e names \u003d splitExtensionNames(url);\n+          cfg \u003d cfg.copyWithExtensions(enabled(names), disabled(names));\n+          break;\n+      }\n+    }\n+    if (extensionsFound) {\n+      return EXTENSIONS_LINK.matcher(markdown).replaceAll(\"\");\n     }\n     return markdown;\n   }\ndiff --git a/javatests/com/google/gitiles/doc/DocServletTest.java b/javatests/com/google/gitiles/doc/DocServletTest.java\nindex 48300fc..2a9c2c5 100644\n--- a/javatests/com/google/gitiles/doc/DocServletTest.java\n+++ b/javatests/com/google/gitiles/doc/DocServletTest.java\n@@ -43,7 +43,10 @@\n     String navbar \u003d\n         \"# Site Title\\n\"\n             + \"\\n\"\n-            + \"* [Home](index.md)\\n\"\n+            + \"[home]: index.md\\n\"\n+            + \"[logo]: logo.png\\n\"\n+            + \"\\n\"\n+            + \"* [Home][home]\\n\"\n             + \"* [README](README.md)\\n\"\n             + \"[extensions]: blocknote\\n\";\n     repo.branch(\"master\")\n@@ -54,7 +57,7 @@\n \n     String html \u003d buildHtml(\"/repo/+doc/master/README.md\");\n     assertThat(html).contains(\"\u003ctitle\u003eSite Title - page\u003c/title\u003e\");\n-\n+    assertThat(html).contains(\"Header-anchorLogo\");\n     assertThat(html).contains(\"\u003cspan class\u003d\\\"Header-anchorTitle\\\"\u003eSite Title\u003c/span\u003e\");\n     assertThat(html).contains(\"\u003cli\u003e\u003ca href\u003d\\\"/b/repo/+/master/index.md\\\"\u003eHome\u003c/a\u003e\u003c/li\u003e\");\n     assertThat(html).contains(\"\u003cli\u003e\u003ca href\u003d\\\"/b/repo/+/master/README.md\\\"\u003eREADME\u003c/a\u003e\u003c/li\u003e\");",
      "revId": "3d52397fffb2ee7f218c4e33f969258011e7c650",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}